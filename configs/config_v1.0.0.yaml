# Main yaml file for pipeline configs. 
#
# Supplies "arguments" for a certain dataset pipeline run, overriding default values provided by DEFAULT_CONFIG in configs.py. 
#   - Affects how the run is executed (usually tweaking this .yaml -> new dataset version.)
#   - Important: NOT where schema.yaml belongs (although configs can reference it.)

# pointer to schema yaml 
schema:
  context: "storm250_context_v1.0.0"

# self describing metadata about the specific dataset run (change as we tweak params)
dataset:
  name: storm250_level2
  version: "1.0.0"

# Dataset mount root directorys
root_dir: "/data/Storm250"

# If true, config.py will mkdir -p root_dir and all directories in paths if the file paths do not exist.
ensure_dirs: true

paths:
  # GR-S tracks 
  grs_raw_dir: "Datasets/cell_tracks/raw_grs"
  grs_processed_dir: "Datasets/cell_tracks/processed_grs"
  grs_linked_dir: "Datasets/cell_tracks/linked_grs"

  # NEXRAD caching / local raw (optional) 
  nexrad_lv2_cache_dir: "Datasets/nexrad_datasets/level_two_raw"
  nexrad_lv3_cache_dir: "Datasets/nexrad_datasets/level_three_raw"

  # Surface obs (optional) 
  lsr_raw_dir: "Datasets/surface_obs_datasets/lsr_raw"
  lsr_reports_dir: "Datasets/surface_obs_datasets/lsr_reports"
  spc_reports_dir: "Datasets/surface_obs_datasets/spc_reports"
  linked_obs_cache_dir: "Datasets/surface_obs_datasets/linked_obs_cache"

  # Scratch 
  temp_dir: "Datasets/temp"

  # Final dataset outputs 
  dataset_out_dir: "Datasets/training_datasets/level_two"
  starter_out_dir: "Datasets/training_datasets/starter"

  # Packaging / release 
  zenodo_bundle_dir: "Datasets/training_datasets/zenodo_bundle"
  release_zenodo_dir: "Release/zenodo"

  # Logs 
  logs_dir: "Logs"
  plots_dir: "Logs/plots"
  env_dir: "Logs/environment"

build:
  # Dataset definition knobs
  max_range_km: 250.0
  time_tolerance_s: 29
  min_track_samples: 60
  max_gap_hours: 6
  reflectivity_dbz_thresh: 20.0
  buffer_km: 5.0

  # Cropping/bbox parameters
  min_blob_size: 6000
  grid_resolution_m: 250.0
  include_nearby_km: 3.0
  debug_plot_limit: 0

  # Data loading parameters
  lsr_force_refresh: false
  grs_base_url: "https://data-osdf.rda.ucar.edu/ncar/rda/d841006/tracks"
  grs_timeout_s: 10
  
  # Product filtering (NEXRAD products to process)
  nexrad_products:
    - reflectivity

  # Execution knobs
  skip_existing: true
  resume: true
  dry_run: false

  use_multiprocessing: true
  n_workers: 8

aws:
  nexrad_bucket: "noaa-nexrad-level2"
  s3_anon: true
  aws_region: null
  retries: 5

logging:
  level: "INFO"

# Execution configuration (runtime parameters)
execution:
  year: 2017
  rewrite_existing: false
  multiprocessing_method: "fork"

# Radar metadata reference
radar_info_yaml: "radar_info.yaml"
